//
//  WeatherListViewModelTests.swift
//  WeatherAppTests
//
//  Created by Kallas on 9/13/19.
//  Copyright Â© 2019 AK. All rights reserved.
//

import XCTest
@testable import WeatherApp
import CoreLocation
import MagicalRecord

class MockLocationService : LocationService {
    func setup() { }
    
    var locationManager: CLLocationManager?
    
    var locationServiceUpdatedObservable: Observable<[CLLocation]>! = Observable()
    
    var locationServiceNotAllowedObservable: Observable<Void>! = Observable()
}


class WeatherListViewModelTests: XCTestCase {
    var locationService:LocationService?
    override func setUp() {
        MagicalRecord.setupCoreDataStackWithInMemoryStore()
        self.locationService = MockLocationService()
        // Put setup code here. This method is called before the invocation of each test method in the class.
    }

    override func tearDown() {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
    }

    func testExample() {
        let mockResponseData = """
{"request_state":200,"request_key":"fd543c77e33d6c8a5e218e948a19e487","message":"OK","model_run":"02","source":"internal:GFS:1","2019-09-10 05:00:00":{"temperature":{"2m":285.6,"sol":286.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101460},"pluie":0,"pluie_convective":0,"humidite":{"2m":59.6},"vent_moyen":{"10m":7.4},"vent_rafales":{"10m":10.1},"vent_direction":{"10m":371},"iso_zero":2100,"risque_neige":"non","cape":0,"nebulosite":{"haute":62,"moyenne":0,"basse":6,"totale":65}},"2019-09-10 08:00:00":{"temperature":{"2m":284.1,"sol":284.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101560},"pluie":0,"pluie_convective":0,"humidite":{"2m":63.4},"vent_moyen":{"10m":6},"vent_rafales":{"10m":9.4},"vent_direction":{"10m":421},"iso_zero":2124,"risque_neige":"non","cape":0,"nebulosite":{"haute":34,"moyenne":0,"basse":5,"totale":37}},"2019-09-10 11:00:00":{"temperature":{"2m":290.1,"sol":288.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101790},"pluie":0,"pluie_convective":0,"humidite":{"2m":43.2},"vent_moyen":{"10m":6.6},"vent_rafales":{"10m":9.4},"vent_direction":{"10m":403},"iso_zero":2098,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-10 14:00:00":{"temperature":{"2m":294.9,"sol":292.4,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101790},"pluie":0,"pluie_convective":0,"humidite":{"2m":29.7},"vent_moyen":{"10m":6.9},"vent_rafales":{"10m":9.4},"vent_direction":{"10m":385},"iso_zero":2232,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-10 17:00:00":{"temperature":{"2m":295.7,"sol":293.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101840},"pluie":0,"pluie_convective":0,"humidite":{"2m":29.1},"vent_moyen":{"10m":10.6},"vent_rafales":{"10m":9.8},"vent_direction":{"10m":365},"iso_zero":2262,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":8,"totale":8}},"2019-09-10 20:00:00":{"temperature":{"2m":291.9,"sol":292.3,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101960},"pluie":0,"pluie_convective":0,"humidite":{"2m":42.3},"vent_moyen":{"10m":10.1},"vent_rafales":{"10m":17.4},"vent_direction":{"10m":383},"iso_zero":3065,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":24,"totale":24}},"2019-09-10 23:00:00":{"temperature":{"2m":288.1,"sol":288.4,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102170},"pluie":0,"pluie_convective":0,"humidite":{"2m":62.8},"vent_moyen":{"10m":10.1},"vent_rafales":{"10m":19.7},"vent_direction":{"10m":366},"iso_zero":3303,"risque_neige":"non","cape":0,"nebulosite":{"haute":4,"moyenne":0,"basse":0,"totale":4}},"2019-09-11 02:00:00":{"temperature":{"2m":286.4,"sol":286.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102230},"pluie":0,"pluie_convective":0,"humidite":{"2m":74.8},"vent_moyen":{"10m":7.2},"vent_rafales":{"10m":11},"vent_direction":{"10m":355},"iso_zero":3307,"risque_neige":"non","cape":0,"nebulosite":{"haute":52,"moyenne":0,"basse":0,"totale":52}},"2019-09-11 05:00:00":{"temperature":{"2m":285.5,"sol":285.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102260},"pluie":0,"pluie_convective":0,"humidite":{"2m":76.7},"vent_moyen":{"10m":5.7},"vent_rafales":{"10m":7.4},"vent_direction":{"10m":321},"iso_zero":3344,"risque_neige":"non","cape":0,"nebulosite":{"haute":55,"moyenne":0,"basse":0,"totale":55}},"2019-09-11 08:00:00":{"temperature":{"2m":285.9,"sol":285.6,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102350},"pluie":0,"pluie_convective":0,"humidite":{"2m":71.1},"vent_moyen":{"10m":2},"vent_rafales":{"10m":3.4},"vent_direction":{"10m":281},"iso_zero":3668,"risque_neige":"non","cape":0,"nebulosite":{"haute":78,"moyenne":14,"basse":0,"totale":78}},"2019-09-11 11:00:00":{"temperature":{"2m":291.1,"sol":288.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102500},"pluie":0,"pluie_convective":0,"humidite":{"2m":53.2},"vent_moyen":{"10m":8.5},"vent_rafales":{"10m":14.1},"vent_direction":{"10m":238},"iso_zero":3562,"risque_neige":"non","cape":0,"nebulosite":{"haute":93,"moyenne":97,"basse":0,"totale":100}},"2019-09-11 14:00:00":{"temperature":{"2m":295.1,"sol":292.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102490},"pluie":0,"pluie_convective":0,"humidite":{"2m":40.9},"vent_moyen":{"10m":13.8},"vent_rafales":{"10m":20.5},"vent_direction":{"10m":252},"iso_zero":3765,"risque_neige":"non","cape":0,"nebulosite":{"haute":46,"moyenne":64,"basse":5,"totale":68}},"2019-09-11 17:00:00":{"temperature":{"2m":296.6,"sol":294.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102440},"pluie":0,"pluie_convective":0,"humidite":{"2m":28.4},"vent_moyen":{"10m":13.9},"vent_rafales":{"10m":19.1},"vent_direction":{"10m":282},"iso_zero":3823,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":9,"basse":14,"totale":15}},"2019-09-11 20:00:00":{"temperature":{"2m":293.5,"sol":293.6,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102450},"pluie":0,"pluie_convective":0,"humidite":{"2m":41.4},"vent_moyen":{"10m":8.7},"vent_rafales":{"10m":18.5},"vent_direction":{"10m":279},"iso_zero":4297,"risque_neige":"non","cape":0,"nebulosite":{"haute":15,"moyenne":4,"basse":13,"totale":22}},"2019-09-11 23:00:00":{"temperature":{"2m":290.5,"sol":290.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102700},"pluie":0,"pluie_convective":0,"humidite":{"2m":72.6},"vent_moyen":{"10m":7.2},"vent_rafales":{"10m":14.8},"vent_direction":{"10m":309},"iso_zero":4409,"risque_neige":"non","cape":0,"nebulosite":{"haute":26,"moyenne":0,"basse":14,"totale":39}},"2019-09-12 02:00:00":{"temperature":{"2m":289.8,"sol":289.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102720},"pluie":0,"pluie_convective":0,"humidite":{"2m":79},"vent_moyen":{"10m":6.1},"vent_rafales":{"10m":16.3},"vent_direction":{"10m":263},"iso_zero":4418,"risque_neige":"non","cape":0,"nebulosite":{"haute":14,"moyenne":0,"basse":7,"totale":20}},"2019-09-12 05:00:00":{"temperature":{"2m":289.5,"sol":289,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102780},"pluie":0,"pluie_convective":0,"humidite":{"2m":84.7},"vent_moyen":{"10m":7.8},"vent_rafales":{"10m":18.2},"vent_direction":{"10m":248},"iso_zero":4322,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":33,"totale":33}},"2019-09-12 08:00:00":{"temperature":{"2m":290.1,"sol":288.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102890},"pluie":0,"pluie_convective":0,"humidite":{"2m":83.8},"vent_moyen":{"10m":8.4},"vent_rafales":{"10m":17.8},"vent_direction":{"10m":239},"iso_zero":4385,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":57,"totale":57}},"2019-09-12 11:00:00":{"temperature":{"2m":293.1,"sol":290.4,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103070},"pluie":0.1,"pluie_convective":0.1,"humidite":{"2m":71.1},"vent_moyen":{"10m":11.7},"vent_rafales":{"10m":18.5},"vent_direction":{"10m":263},"iso_zero":4465,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":81,"totale":81}},"2019-09-12 14:00:00":{"temperature":{"2m":294.4,"sol":291.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103080},"pluie":0.1,"pluie_convective":0,"humidite":{"2m":61.5},"vent_moyen":{"10m":12.3},"vent_rafales":{"10m":16.1},"vent_direction":{"10m":277},"iso_zero":4517,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":84,"totale":84}},"2019-09-12 17:00:00":{"temperature":{"2m":295.1,"sol":292.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103000},"pluie":0,"pluie_convective":0,"humidite":{"2m":61},"vent_moyen":{"10m":9.3},"vent_rafales":{"10m":14.8},"vent_direction":{"10m":270},"iso_zero":4434,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":100,"totale":100}},"2019-09-12 20:00:00":{"temperature":{"2m":294.2,"sol":293.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103050},"pluie":0,"pluie_convective":0,"humidite":{"2m":66},"vent_moyen":{"10m":5.7},"vent_rafales":{"10m":11.6},"vent_direction":{"10m":253},"iso_zero":4400,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":100,"totale":100}},"2019-09-12 23:00:00":{"temperature":{"2m":293.6,"sol":292.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103210},"pluie":0.1,"pluie_convective":0.1,"humidite":{"2m":71.6},"vent_moyen":{"10m":5.5},"vent_rafales":{"10m":10.6},"vent_direction":{"10m":269},"iso_zero":4446,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":100,"totale":100}},"2019-09-13 02:00:00":{"temperature":{"2m":291.7,"sol":292.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103130},"pluie":0.1,"pluie_convective":0.1,"humidite":{"2m":82.8},"vent_moyen":{"10m":4.4},"vent_rafales":{"10m":6.5},"vent_direction":{"10m":336},"iso_zero":4492,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":77,"totale":77}},"2019-09-13 05:00:00":{"temperature":{"2m":289.9,"sol":289.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103150},"pluie":0,"pluie_convective":0,"humidite":{"2m":87.5},"vent_moyen":{"10m":5.9},"vent_rafales":{"10m":9.8},"vent_direction":{"10m":329},"iso_zero":4464,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":60,"totale":60}},"2019-09-13 08:00:00":{"temperature":{"2m":289.3,"sol":288.6,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103160},"pluie":0,"pluie_convective":0,"humidite":{"2m":87.3},"vent_moyen":{"10m":4.2},"vent_rafales":{"10m":6.8},"vent_direction":{"10m":327},"iso_zero":4419,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":38,"totale":38}},"2019-09-13 11:00:00":{"temperature":{"2m":293.2,"sol":290.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103270},"pluie":0,"pluie_convective":0,"humidite":{"2m":70.9},"vent_moyen":{"10m":6.7},"vent_rafales":{"10m":7.8},"vent_direction":{"10m":345},"iso_zero":4332,"risque_neige":"non","cape":0,"nebulosite":{"haute":14,"moyenne":0,"basse":47,"totale":59}},"2019-09-13 14:00:00":{"temperature":{"2m":296.4,"sol":292.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103190},"pluie":0,"pluie_convective":0,"humidite":{"2m":57.6},"vent_moyen":{"10m":7},"vent_rafales":{"10m":7.3},"vent_direction":{"10m":324},"iso_zero":4377,"risque_neige":"non","cape":0,"nebulosite":{"haute":7,"moyenne":0,"basse":55,"totale":61}},"2019-09-13 17:00:00":{"temperature":{"2m":296.3,"sol":293.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103080},"pluie":0.1,"pluie_convective":0.1,"humidite":{"2m":56.8},"vent_moyen":{"10m":5.5},"vent_rafales":{"10m":6.5},"vent_direction":{"10m":359},"iso_zero":4367,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":98,"totale":98}},"2019-09-13 20:00:00":{"temperature":{"2m":294.7,"sol":293.3,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103070},"pluie":0,"pluie_convective":0,"humidite":{"2m":64.1},"vent_moyen":{"10m":11.3},"vent_rafales":{"10m":17.3},"vent_direction":{"10m":382},"iso_zero":4315,"risque_neige":"non","cape":0,"nebulosite":{"haute":25,"moyenne":0,"basse":99,"totale":99}},"2019-09-13 23:00:00":{"temperature":{"2m":293.1,"sol":291.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103180},"pluie":0,"pluie_convective":0,"humidite":{"2m":67.5},"vent_moyen":{"10m":13.5},"vent_rafales":{"10m":26.6},"vent_direction":{"10m":396},"iso_zero":4169,"risque_neige":"non","cape":0,"nebulosite":{"haute":1,"moyenne":0,"basse":100,"totale":100}},"2019-09-14 02:00:00":{"temperature":{"2m":289.4,"sol":288.3,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103190},"pluie":0,"pluie_convective":0,"humidite":{"2m":75.8},"vent_moyen":{"10m":14.8},"vent_rafales":{"10m":30.4},"vent_direction":{"10m":390},"iso_zero":4106,"risque_neige":"non","cape":0,"nebulosite":{"haute":10,"moyenne":0,"basse":79,"totale":80}},"2019-09-14 05:00:00":{"temperature":{"2m":287.1,"sol":287,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103120},"pluie":0,"pluie_convective":0,"humidite":{"2m":84.7},"vent_moyen":{"10m":12},"vent_rafales":{"10m":26.7},"vent_direction":{"10m":389},"iso_zero":4105,"risque_neige":"non","cape":0,"nebulosite":{"haute":8,"moyenne":0,"basse":0,"totale":8}},"2019-09-14 08:00:00":{"temperature":{"2m":286.7,"sol":285.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103170},"pluie":0,"pluie_convective":0,"humidite":{"2m":86.5},"vent_moyen":{"10m":13.6},"vent_rafales":{"10m":28.5},"vent_direction":{"10m":383},"iso_zero":4196,"risque_neige":"non","cape":0,"nebulosite":{"haute":36,"moyenne":0,"basse":0,"totale":36}},"2019-09-14 11:00:00":{"temperature":{"2m":292.3,"sol":289.4,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103190},"pluie":0,"pluie_convective":0,"humidite":{"2m":59.1},"vent_moyen":{"10m":13.2},"vent_rafales":{"10m":22.3},"vent_direction":{"10m":397},"iso_zero":4111,"risque_neige":"non","cape":0,"nebulosite":{"haute":42,"moyenne":0,"basse":0,"totale":42}},"2019-09-14 14:00:00":{"temperature":{"2m":296.4,"sol":292.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103090},"pluie":0,"pluie_convective":0,"humidite":{"2m":40.7},"vent_moyen":{"10m":15.6},"vent_rafales":{"10m":19.3},"vent_direction":{"10m":389},"iso_zero":4196,"risque_neige":"non","cape":0,"nebulosite":{"haute":21,"moyenne":0,"basse":0,"totale":21}},"2019-09-14 17:00:00":{"temperature":{"2m":297.2,"sol":294.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102970},"pluie":0,"pluie_convective":0,"humidite":{"2m":33.2},"vent_moyen":{"10m":18.3},"vent_rafales":{"10m":24.3},"vent_direction":{"10m":392},"iso_zero":4383,"risque_neige":"non","cape":0,"nebulosite":{"haute":4,"moyenne":0,"basse":0,"totale":4}},"2019-09-14 20:00:00":{"temperature":{"2m":292.7,"sol":292.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103010},"pluie":0,"pluie_convective":0,"humidite":{"2m":43.8},"vent_moyen":{"10m":16},"vent_rafales":{"10m":32.5},"vent_direction":{"10m":393},"iso_zero":4465,"risque_neige":"non","cape":0,"nebulosite":{"haute":5,"moyenne":0,"basse":0,"totale":5}},"2019-09-14 23:00:00":{"temperature":{"2m":289.2,"sol":289.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103140},"pluie":0,"pluie_convective":0,"humidite":{"2m":52.5},"vent_moyen":{"10m":17.6},"vent_rafales":{"10m":41.7},"vent_direction":{"10m":404},"iso_zero":4446,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 02:00:00":{"temperature":{"2m":286.9,"sol":286.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103140},"pluie":0,"pluie_convective":0,"humidite":{"2m":58.3},"vent_moyen":{"10m":16.4},"vent_rafales":{"10m":39.4},"vent_direction":{"10m":406},"iso_zero":4388,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 05:00:00":{"temperature":{"2m":284.9,"sol":285,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":103040},"pluie":0,"pluie_convective":0,"humidite":{"2m":62.9},"vent_moyen":{"10m":14.2},"vent_rafales":{"10m":32.2},"vent_direction":{"10m":409},"iso_zero":4362,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 08:00:00":{"temperature":{"2m":284.2,"sol":284.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102980},"pluie":0,"pluie_convective":0,"humidite":{"2m":65.6},"vent_moyen":{"10m":13.1},"vent_rafales":{"10m":31.5},"vent_direction":{"10m":417},"iso_zero":4369,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 11:00:00":{"temperature":{"2m":290.2,"sol":287.6,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102880},"pluie":0,"pluie_convective":0,"humidite":{"2m":45.9},"vent_moyen":{"10m":14.4},"vent_rafales":{"10m":24.2},"vent_direction":{"10m":426},"iso_zero":4406,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 14:00:00":{"temperature":{"2m":296.1,"sol":293.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102680},"pluie":0,"pluie_convective":0,"humidite":{"2m":29.5},"vent_moyen":{"10m":15.6},"vent_rafales":{"10m":22},"vent_direction":{"10m":430},"iso_zero":4386,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 17:00:00":{"temperature":{"2m":297.6,"sol":295.4,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102370},"pluie":0,"pluie_convective":0,"humidite":{"2m":28.2},"vent_moyen":{"10m":15.8},"vent_rafales":{"10m":21.3},"vent_direction":{"10m":424},"iso_zero":4388,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 20:00:00":{"temperature":{"2m":293.4,"sol":294.2,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102230},"pluie":0,"pluie_convective":0,"humidite":{"2m":38.6},"vent_moyen":{"10m":11.7},"vent_rafales":{"10m":25},"vent_direction":{"10m":422},"iso_zero":4376,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-15 23:00:00":{"temperature":{"2m":290.2,"sol":291.3,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102190},"pluie":0,"pluie_convective":0,"humidite":{"2m":46.9},"vent_moyen":{"10m":10.4},"vent_rafales":{"10m":21.3},"vent_direction":{"10m":422},"iso_zero":4342,"risque_neige":"non","cape":0,"nebulosite":{"haute":3,"moyenne":0,"basse":0,"totale":3}},"2019-09-16 02:00:00":{"temperature":{"2m":288.4,"sol":289.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102050},"pluie":0,"pluie_convective":0,"humidite":{"2m":52.3},"vent_moyen":{"10m":7.8},"vent_rafales":{"10m":13.4},"vent_direction":{"10m":420},"iso_zero":4268,"risque_neige":"non","cape":0,"nebulosite":{"haute":33,"moyenne":0,"basse":0,"totale":33}},"2019-09-16 05:00:00":{"temperature":{"2m":287.3,"sol":287.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101860},"pluie":0,"pluie_convective":0,"humidite":{"2m":57.8},"vent_moyen":{"10m":6.6},"vent_rafales":{"10m":8.9},"vent_direction":{"10m":407},"iso_zero":4170,"risque_neige":"non","cape":0,"nebulosite":{"haute":100,"moyenne":0,"basse":0,"totale":100}},"2019-09-16 08:00:00":{"temperature":{"2m":286.2,"sol":286.4,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101820},"pluie":0,"pluie_convective":0,"humidite":{"2m":62.9},"vent_moyen":{"10m":6.9},"vent_rafales":{"10m":9},"vent_direction":{"10m":381},"iso_zero":4038,"risque_neige":"non","cape":0,"nebulosite":{"haute":76,"moyenne":0,"basse":0,"totale":76}},"2019-09-16 11:00:00":{"temperature":{"2m":292,"sol":290.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101910},"pluie":0,"pluie_convective":0,"humidite":{"2m":44.6},"vent_moyen":{"10m":9},"vent_rafales":{"10m":14.8},"vent_direction":{"10m":393},"iso_zero":3942,"risque_neige":"non","cape":0,"nebulosite":{"haute":74,"moyenne":0,"basse":0,"totale":74}},"2019-09-16 14:00:00":{"temperature":{"2m":297.7,"sol":295.5,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101800},"pluie":0,"pluie_convective":0,"humidite":{"2m":28.3},"vent_moyen":{"10m":9},"vent_rafales":{"10m":10.6},"vent_direction":{"10m":394},"iso_zero":3807,"risque_neige":"non","cape":0,"nebulosite":{"haute":43,"moyenne":0,"basse":0,"totale":43}},"2019-09-16 17:00:00":{"temperature":{"2m":299.3,"sol":297.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101670},"pluie":0,"pluie_convective":0,"humidite":{"2m":25.9},"vent_moyen":{"10m":9.7},"vent_rafales":{"10m":9.2},"vent_direction":{"10m":372},"iso_zero":3814,"risque_neige":"non","cape":0,"nebulosite":{"haute":26,"moyenne":0,"basse":0,"totale":26}},"2019-09-16 20:00:00":{"temperature":{"2m":294.6,"sol":295.3,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101690},"pluie":0,"pluie_convective":0,"humidite":{"2m":39.8},"vent_moyen":{"10m":11.1},"vent_rafales":{"10m":21.7},"vent_direction":{"10m":370},"iso_zero":3732,"risque_neige":"non","cape":0,"nebulosite":{"haute":18,"moyenne":0,"basse":0,"totale":18}},"2019-09-16 23:00:00":{"temperature":{"2m":290.1,"sol":290.3,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101860},"pluie":0,"pluie_convective":0,"humidite":{"2m":57.3},"vent_moyen":{"10m":14.2},"vent_rafales":{"10m":29.5},"vent_direction":{"10m":369},"iso_zero":3714,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-17 02:00:00":{"temperature":{"2m":287.4,"sol":287.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101900},"pluie":0,"pluie_convective":0,"humidite":{"2m":69.9},"vent_moyen":{"10m":11.1},"vent_rafales":{"10m":24.3},"vent_direction":{"10m":398},"iso_zero":3751,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-17 05:00:00":{"temperature":{"2m":285.7,"sol":285.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101870},"pluie":0,"pluie_convective":0,"humidite":{"2m":83.7},"vent_moyen":{"10m":10.1},"vent_rafales":{"10m":20.2},"vent_direction":{"10m":388},"iso_zero":3799,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-17 08:00:00":{"temperature":{"2m":285.4,"sol":285.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101920},"pluie":0,"pluie_convective":0,"humidite":{"2m":89.7},"vent_moyen":{"10m":10.8},"vent_rafales":{"10m":24.5},"vent_direction":{"10m":387},"iso_zero":3705,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":4,"totale":4}},"2019-09-17 11:00:00":{"temperature":{"2m":290,"sol":287.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102060},"pluie":0,"pluie_convective":0,"humidite":{"2m":71.2},"vent_moyen":{"10m":15.6},"vent_rafales":{"10m":23.6},"vent_direction":{"10m":387},"iso_zero":3583,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":4,"basse":11,"totale":15}},"2019-09-17 14:00:00":{"temperature":{"2m":292.5,"sol":289.9,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102040},"pluie":0,"pluie_convective":0,"humidite":{"2m":50.1},"vent_moyen":{"10m":16.2},"vent_rafales":{"10m":20.2},"vent_direction":{"10m":383},"iso_zero":3586,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":3,"basse":34,"totale":37}},"2019-09-17 17:00:00":{"temperature":{"2m":293.2,"sol":291.1,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":101960},"pluie":0,"pluie_convective":0,"humidite":{"2m":41.4},"vent_moyen":{"10m":19.2},"vent_rafales":{"10m":22.4},"vent_direction":{"10m":361},"iso_zero":3498,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":2,"totale":2}},"2019-09-17 20:00:00":{"temperature":{"2m":288.9,"sol":288.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102060},"pluie":0,"pluie_convective":0,"humidite":{"2m":49.2},"vent_moyen":{"10m":15.7},"vent_rafales":{"10m":26.2},"vent_direction":{"10m":376},"iso_zero":3255,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":1,"totale":1}},"2019-09-17 23:00:00":{"temperature":{"2m":285,"sol":284.7,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102320},"pluie":0,"pluie_convective":0,"humidite":{"2m":66.1},"vent_moyen":{"10m":16.7},"vent_rafales":{"10m":36.4},"vent_direction":{"10m":379},"iso_zero":3205,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}},"2019-09-18 02:00:00":{"temperature":{"2m":282.9,"sol":282.8,"500hPa":-0.1,"850hPa":-0.1},"pression":{"niveau_de_la_mer":102370},"pluie":0,"pluie_convective":0,"humidite":{"2m":72.6},"vent_moyen":{"10m":14.5},"vent_rafales":{"10m":36.8},"vent_direction":{"10m":385},"iso_zero":3118,"risque_neige":"non","cape":0,"nebulosite":{"haute":0,"moyenne":0,"basse":0,"totale":0}}}
"""
        let data = mockResponseData.data(using: .utf8)!
        var serializedData: WeattherAPIResponse? = nil
        do {
            serializedData = try WeattherAPIResponse(data: data)
            
        }catch {
            
        }
        
        let weatherDataList = mockInsertToDatabase(weatherAPIResponse: serializedData)
        
        let mockScuessServerResponse = ServerResponse<[WeatherData]>.success(weatherDataList)
        
        let viewModel = WeatherListViewModel(locationService: MockLocationService())
        
        let firstWeatherData = weatherDataList[0]
        let firstIndex = IndexPath(row: 0, section: 0)
        
        viewModel.didInsertNewObject(CoreDataWeatherObjectNotification(object: firstWeatherData, indexPath: firstIndex, newIndexPath: nil))
        
        let weatherCellModel = WeatherCellModel.from(weatherData: firstWeatherData)
        let expectedValue: WeatherCellViewNotificationObject? = WeatherCellViewNotificationObject(object: weatherCellModel, indexPath: firstIndex, newIndexPath: nil)
        let calculatedValue = viewModel.getDidInsertObjectAtIndextPathObservable().value
        XCTAssertEqual(calculatedValue, expectedValue)
        // This is an example of a functional test case.
        // Use XCTAssert and related functions to verify your tests produce the correct results.
    }


    
    func testPerformanceExample() {
        // This is an example of a performance test case.
        self.measure {
            // Put the code you want to measure the time of here.
        }
    }

    private func mockInsertToDatabase(weatherAPIResponse: WeattherAPIResponse?) -> [WeatherData] {
        return weatherAPIResponse!.weatherInDateTimeList.compactMap{$0}.map ({ (weatherData) -> WeatherData? in
            return updateFromWeatherApiData(weatherAPIData: weatherData)
        }).compactMap{ $0 }
    }
    
    private func updateFromWeatherApiData(weatherAPIData:WeatherInDateTime) -> WeatherData? {
        let weatherData = WeatherData.mr_createEntity()
        weatherData?.temperature_2m = weatherAPIData.temperature.the2M
        weatherData?.temperature_sol = weatherAPIData.temperature.sol
        weatherData?.temperature_500hpa = weatherAPIData.temperature.the500HPa
        weatherData?.temperature_850hpa = weatherAPIData.temperature.the850HPa
        
        weatherData?.pression = Int32(weatherAPIData.pression.niveauDeLaMer)
        weatherData?.pluie = weatherAPIData.pluie
        weatherData?.pluieConvective = weatherAPIData.pluieConvective
        weatherData?.humidity = Int16(weatherAPIData.humidite.the2M)
        weatherData?.ventMoyen = Int16(weatherAPIData.ventMoyen.the10M)
        weatherData?.ventRafales = Int16(weatherAPIData.ventRafales.the10M)
        weatherData?.isoZero = Int32(weatherAPIData.isoZero)
        weatherData?.risqueNeige = weatherAPIData.risqueNeige
        weatherData?.cape = Int16(weatherAPIData.cape)
        weatherData?.nebulositeHaute = Int16(weatherAPIData.nebulosite.haute)
        weatherData?.nebulositeMoyenne = Int16(weatherAPIData.nebulosite.moyenne)
        weatherData?.nebulositeHaute = Int16(weatherAPIData.nebulosite.haute)
        weatherData?.nebulositeTotale = Int16(weatherAPIData.nebulosite.totale)
        
        weatherData?.dateTime = weatherAPIData.dateTime
        
        return weatherData
        
    }
}


extension WeatherCellViewNotificationObject:Equatable {
    public static func == (lhs: WeatherCellViewNotificationObject, rhs: WeatherCellViewNotificationObject) -> Bool {
        return lhs.object == rhs.object && lhs.indexPath == rhs.indexPath && lhs.newIndexPath == rhs.newIndexPath
    }
}

extension WeatherCellModel : Equatable {
    public static func == (lhs: WeatherCellModel, rhs: WeatherCellModel) -> Bool {
        return lhs.dateTime == rhs.dateTime && lhs.temperature == rhs.temperature
    }
    
    
}
